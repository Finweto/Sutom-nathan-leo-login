<link rel="stylesheet" type="text/css" href="/css/style.css" />

<html>

<body>
    <header>
        <h1>Projet Microservices</h1>
        <h1>Nathan Oliveira Da Silva - LÃ©o Bernard</h2>
    </header>
    <div class="main-content">
        <h1>Bonjour, veuillez renseigner votre login et mot de passe</h1>
        <form id="login-form" action='post'>
            <label for="clientName">Login</label>
            <input id="inputName" type="text" name="clientName">
            <label for="clientPassword">Password</label>
            <input id="inputPassword" type="password" name="clientPassword">
            <input type="submit" value="Submit">
        </form>
    </div>
</body>

</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<script type="module">
    // async function to set sessionStorage
    async function setSessionStorage(nameInput) {
        // set name item
        sessionStorage.setItem('name', nameInput)

        // set anti cheat
        sessionStorage.setItem('previousWord', '')

        // set score obj
        sessionStorage.setItem('scores', JSON.stringify([]))

        // set Tries
        sessionStorage.setItem('avgTry', 0)
        sessionStorage.setItem('nbTry', 0)

        console.log('finished setting sessionStorage')
        return 0
    }

    document.getElementById("login-form").addEventListener("submit", function (event) {
        // prevent change of page on submit 
        event.preventDefault()

        // get client input
        const nameInput = event.target[0].value
        const passwordInput = event.target[1].value

        // show wrong name or password or redirect with code
        $.post('/verifyLogin', { name: nameInput, password: passwordInput }, async (data) => {
            if (data) {
                await setSessionStorage(nameInput)

                console.log('redirection to main')
                document.location = `/redirect?name=${data.name}&code=${data.code}`
            }
            else {
                alert('mauvais Name ou Mot de passe')
            }
        })

    })
</script>